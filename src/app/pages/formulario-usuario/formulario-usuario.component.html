<app-page-header
    [titulo]="'Nuevo usuario'"
    [icono]="'fas fa-user-plus'"
    [breadcrumbs]="breads"
  >
  </app-page-header>

  <!--Contenido de la página-->
  <section class="content">
    <div class="container-fluid">
      <ngx-loading-bar
      color="#339942"
      height="2"
      animationTime="0.8"
    ></ngx-loading-bar>
        <div class="col-md-12">

            <div class="row align-items-center">

                
                <div class="col-md-12">
    
    
                    <div class="card card-primary">
    
                        <div class="card-header">
                            <h3 class="card-title">Crear nuevo usuario</h3>
                            <div class="card-tools">
    
                            </div>
                        </div>
                        <div class="card-body">

                            <form role="form"
                            #usuarioForm="ngForm" (ngSubmit)="onSubmit(usuarioForm)">
                            <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="usuario">Nombre de usuario:</label>
                                    <div class="input-group mb-3">
                                      <input type="text" #nombre="ngModel"
                                      [(ngModel)]="usuario.usuario" name="nombreUsuario" 
                                      class="form-control" placeholder="Usuario" required 
                                      [ngClass]="{
                                        'is-invalid': !nombre.valid && nombre.touched
                                      }" />
                                      <div class="input-group-append">
                                        <div class="input-group-text">
                                          <span class="fas fa-user"></span>
                                        </div>
                                      </div>
                                    </div>
                                    <small
                      class="text-danger"
                      *ngIf="!nombre.valid && nombre.touched"
                    >
                      Campo requerido
                    </small>
                                </div>
                              </div>
                              <!--<div class="col-md-2"></div>-->
                              <div class="col-md-6">
                              <div class="form-group">
                                <label for="rol">Rol de usuario:</label>
                                <div class="input-group mb-3">
                                  <select name="rolUsuario" class="form-control"
                                  [(ngModel)]="usuario.rol" #rol="ngModel" [ngClass]="{
                                    'is-invalid': !rol.valid && rol.touched
                                  }" required>
                                      <option value="Administrador">Administrador</option>
                                      <option value="Enfermero">Enfermer@</option>
                                      <option value="Laboratorista">Laboratorista</option>
                                      <option value="Recepcionista">Recepcionista</option>
                                  </select>
                                  <div class="input-group-append">
                                    <div class="input-group-text">
                                      <span class="fas fa-user-cog"></span>
                                    </div>
                                  </div>
                                </div>
                                <small
                  class="text-danger"
                  *ngIf="rol.value == '' && rol.touched"
                >
                  Campo requerido
                </small>

                            </div>
                          </div>
                            </div>
                                <div class="row">
                                  <div class="col-md-6">
                                <div class="form-group">
                                    <label for="password">Contraseña: </label>
                                    <div class="input-group mb-3">
                                      <input
                                      required
                                      name="contra"
                                        #contraUsuario="ngModel"
                                        type="password"
                                        class="form-control"
                                        placeholder="Contraseña"
                                      [(ngModel)]="usuario.pass"
                                      (ngModelChange)="passLgth()"
                                      [ngClass]="{
                                        'is-invalid': !contraUsuario.valid && contraUsuario.touched
                                      }" 
                                      />
                                      <div class="input-group-append">
                                        <div class="input-group-text">
                                          <span class="fas fa-lock"></span>
                                        </div>
                                      </div>
                                      
                                    </div>
                                   <small
                        class="text-danger"
                        *ngIf="minPass"
                      >
                        Debe contener un mínimo de 8 caractéres
                      </small>
                                </div>
                              </div>
                              <!--<div class="col-md-2"></div>-->
                              <div class="col-md-6">
                              <div class="form-group">
                                <label for="password">Confirmar contraseña: </label>
                                <div class="input-group mb-3">
                                  <input
                                    name="passwordCofirm"
                                    #passwor="ngModel"
                                    type="password"
                                    class="form-control"
                                    placeholder="Contraseña"
                                  [(ngModel)]="pas"
                                  (ngModelChange)="validarPass()"
                                  [ngClass]="{
                                    'is-invalid': !passwor.valid && passwor.touched
                                  }" 
                                  />
                                  
                                  <div class="input-group-append">
                                    <div class="input-group-text">
                                      <span class="fas fa-lock"></span>
                                    </div>
                                  </div>
                                </div>
                               <small
                    class="text-danger"
                    *ngIf="valPass == false"
                  >
                    Las contraseñas no coinciden
                  </small>
                            </div>
                          </div>
                              </div>
                                
 
                                <div class="row">
                                  <!-- /.col -->
                                  <div class="col-md-9"></div>
                                  <div class="col-md-3">
                                      <button type="submit" class="btn btn-primary mr-3" 
                                      [disabled]="usuarioForm.invalid || minPass || !valPass">
                                          Guardar usuario
                                      </button>
                                      <button type="reset" class="btn btn-secondary" [ngStyle]="{'display': 'space-between'}">
                                         Cancelar
                                      </button>
                                
                                  </div>
                                  
                                  <!-- /.col -->
                                </div>
                              </form>

                        </div>
                    </div>
    
                </div>
                
                

                  <!-- Sweet alerts -->
                  <!-- Sweet Confirm -->
                  <swal
                  #redireccionSwal
                  title="Usuario guardado!"
                  text="El usuario ha sido guardado con éxito"
                  icon="success"
                  [showCancelButton]="false"
                  confirmButtonText="Ok!"
                  cancelButtonText="No!"
                  confirmButtonColor="#3085d6"
                  cancelButtonColor="#bbbbbb"
                  [focusCancel]="true"
                  (confirm)="getUsuarios()"
                >
                </swal>

                <!-- Sweet error -->

                <swal
                  #errorSwal
                  title="Error!"
                  text="No se pudo realizar el registro"
                  icon="error"
                  confirmButtonText="Ok"
                  confirmButtonColor="#3085d6"
                  [focusConfirm]="true"
                >
                </swal>

                <!-- Sweet alerts -->

            </div>
            <div class="col-md-12">
              <div class="card card-primary">
                <div class="card-header">
                  <h3 class="card-title">Usuarios registrados</h3>
                  <div class="card-tools">
                                
                    
                    
                  </div>
                  <!-- card tools -->
                </div>
                <!-- /.card-header -->
                
                <div class="card-body">
            
                    <table datatable [dtOptions]="dtOptions"
                    [dtTrigger]="dtTrigger" class="row-border hover table table-bordered table-striped">
                        <thead>
                          <tr>
                            <th>Nombre de usuario</th>
                              <th>Rol de usuario</th>
                              <th>Fecha de registro</th>
                              <th>Modificar</th>
                              <th>Eliminar</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let user of usuarios">
                            <td>{{user.usuario}}</td>
                            <td>{{user.rol}}</td>
                            <td>{{user.fechaRegistro}}</td>
                            <td><button type="button" (click)="llenarCampos(user._id)" class="btn btn-block btn-default">
                              <a  style="color: gray;">
        
                                <i class="fa fa-wrench"></i>
                              </a>
                            </button></td>
                            <td><button type="button" (click)="eliminarUsuario(user._id)" class="btn btn-block btn-default">
                              <a  style="color: gray;">
        
                                <i class="fa fa-user-times"></i>
                              </a>
                            </button></td>
                              
                          </tr>
                          
                        </tbody>
                    </table>
                </div>
                <!-- /.card-body -->
                
              </div>
              <!-- /.card -->
            </div>
            
                  <!-- Sweet alerts -->
                  <!-- Sweet Confirm -->
                  <swal
                  #redireccionSwalDel
                  title="Estás seguro!"
                  text="El usuario seleccionado será eliminado"
                  icon="warning"
                  [showCancelButton]="true"
                  confirmButtonText="Sí!"
                  cancelButtonText="No!"
                  confirmButtonColor="#3085d6"
                  cancelButtonColor="#bbbbbb"
                  [focusCancel]="true"
                  (confirm)="getUsuarios()"
                >
                </swal>

                <!-- Sweet error -->

                <swal
                  #errorSwalDel
                  title="Error!"
                  text="No se pudo eliminar el registro"
                  icon="error"
                  confirmButtonText="Ok"
                  confirmButtonColor="#3085d6"
                  [focusConfirm]="true"
                >
                </swal>

                <!-- Sweet alerts -->
           
        </div><!-- Div col-md-12-->

    </div><!--Fin del container-fluid-->
  </section>



